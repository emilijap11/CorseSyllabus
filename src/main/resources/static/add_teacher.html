<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add Teacher</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<h1>Add Teacher</h1> 

<input id="teacherFirstName" placeholder="First Name">
<input id="teacherLastName" placeholder="Last Name">
<input id="teacherEmail" placeholder="Email">
<input id="teacherTitle" placeholder="Title">
<select id="courseName"></select> 

<button onclick="addTeacher()">Add Teacher</button>
<p id="teacherResult"></p>
<button onclick="window.location.href='teachers.html'">Show All Teachers</button> 
<button onclick="window.location.href='index.html'">Back</button>

<script>
    async function readErrorMessage(res) {
        try {
            const data = await res.json();
            return data.detail || data.message || data.error || JSON.stringify(data);
        } catch (e) {
            return await res.text();
        }
    }

    async function addTeacher(){
        const result = teacherResult;
        const teacher={
            firstName:teacherFirstName.value,
            lastName:teacherLastName.value,
            email:teacherEmail.value,
            title:teacherTitle.value,
            courseId: null,
            courseName: courseName.value || null
        };
        if (!teacher.firstName || !teacher.lastName || !teacher.email || !teacher.title || !teacher.courseName) {
            result.innerText = "Error: All fields are required, including course.";
            result.className = "error";
            return;
        }
        try{
            const res = await fetch("/api/teachers",{
                method:"POST",
                headers:{"Content-Type":"application/json"},
                body:JSON.stringify(teacher)
            });
            if(res.ok){
                const data = await res.json();
                result.innerText="Success: Teacher added.";
                result.className="result";
            } else {
                const text = await readErrorMessage(res);
                result.innerText="Error: "+text;
                result.className="error";
            }
        } catch(err){
            result.innerText="Error: "+err;
            result.className="error";
        }
    }

    async function loadCourses() {
        const select = document.getElementById("courseName");
        select.innerHTML = "";
        const placeholder = document.createElement("option");
        placeholder.value = "";
        placeholder.textContent = "Select Course";
        select.appendChild(placeholder);
        const res = await fetch("/api/courses");
        if (!res.ok) {
            teacherResult.innerText = "Error: Cannot load courses.";
            teacherResult.className = "error";
            return;
        }
        const data = await res.json();
        if (!data || data.length === 0) {
            placeholder.textContent = "No courses available";
            select.disabled = true;
            return;
        }
        select.disabled = false;
        data.forEach(c => {
            const opt = document.createElement("option");
            opt.value = c.name;
            opt.textContent = c.name;
            select.appendChild(opt);
        });
    }

    loadCourses();

</script>
</body>
</html>
